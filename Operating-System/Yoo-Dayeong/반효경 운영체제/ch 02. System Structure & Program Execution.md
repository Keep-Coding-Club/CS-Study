## 1. 컴퓨터 시스템 구조

컴퓨터 ) CPU, 메모리

메모리에 있는 운영체제

CPU는 프로그램을 정해진 스케줄링에 따라 가져옴.

### CPU 내부

- 레지스터
  - 메모리보다 빠르면서 정보저장이 가능한 공간
- mode bit
  - CPU에서 실행되는 것이 운영체제인지 프로그램인지 구분
  - 1: 프로그램, 0: OS코드
- interrupt line
  - CPU는 메모리에 있는 명령어만 수행하되, 장치 컨트롤러에서 필요한 것을 CPU에 요청할 경우 interrupt 사용

CPU와 메모리 이외, DMA controller와 timer 존재

### DMA controller

Direct Memory Access controller

메모리에 직접 접근 가능한 컨트롤러

원래는 메모리에 직접 접근 가능한 건 CPU 뿐이었음.

DMA controller가 없었다면..?

CPU는 빠르게 일처리.

이때 타이머, 여러 입출력 장치들이 interrupt를 요청하면 CPU는 일을 멈추고 요청 수행.

이렇게 되면 효율적인 일처리가 불가하므로, DMA controller가 CPU의 역할을 분담해주는 것

어떻게?

입출력 장치에 있는 buffer에서 메모리로 복사

### **timer**

타이머는 정해진 시간이 흐른 뒤 운영체제에게 제어권이 넘어가도록 인터럽트를 발생시키는 역할

이러한 역할을 하는 타이머는 왜 필요할까?

만약, 사용자 프로그램1이 CPU에서 처리되고 있는데 이 사용자 프로그램1이 독점적으로 CPU를 오랜기간동안 사용하게 된다면 매우 비효율적일 것이다.

그래서 일정 시간을 정해두어 그 시간이 지나면 다음 instruction이 실행될 수 있도록 설정해주는 것이다.

이제 더 자세히 예를 들어 설명하면서 필요한 개념들을 정리해 보겠다.

**예1) 사용자 프로그램이 실행되면서 키보드를 통해 입력값을 받아야하거나 모니터에 출력을 하라는 명령이 있다. 그러면 어떻게 동작이 될까?**

먼저, CPU는 사용자 프로그램으로 동작하고 있으므로 mode bit는 1이 되고 앞에서 말했듯이 사용자 프로그램은 I/O 디바이스에 직접적으로 명령이나 접근할 권한이 없다.

그러면 어떻게 해야할까?

**운영체제**가 일을 해야한다. 운영체제는 I/O 디바이스에 부착된 device controller에게 명령을 내릴 수 있다.

먼저, 사용자 프로그램은 운영체제에게 I/O요청을 해야하는데 이 과정을 **`시스템콜(system call)`**이라 한다.

시스템 콜은 사용자 프로그램이 CPU에게 인터럽트(interrupt)를 발생시켜 작업을 중단시키고 운영체제로 넘기게 한다. 그러면 mode bit는 0으로 바뀌고 비로소 운영체제가 I/O요청이 가능해진다.

==> 여기서 배운 2가지

1. 시스템콜(system call)

2. 사용자 프로그램도 CPU에게 interrupt를 걸 수 있다.

마지막으로, 인터럽트(interrupt)에 대한 개념을 더 정리해보려고 한다.

위에서 interrupt를 거는 경우가 꽤 있었다.

`타이머`가 걸 수도 있고 `디바이스 컨트롤러`가 걸 수도 있고 `사용자 프로그램`이 걸 수도 있다. 그래서 인터럽트(interrput)를 넓은 의미로 보면 2가지로 나뉜다.

**1. 하드웨어 인터럽트**

하드웨어 인터럽트는 하드웨어가 발생시킨 인터럽트로 보통 인터럽트라고 하면 하드웨어 인터럽트를 말하는 것이다.

여기서 말하는 하드웨어는 타이머, 디바이스 컨트롤러, DMA 컨트롤러 등이 있다.

**2. trap**

트랩은 소프트웨어 인터럽트로 Exception과 system call로 나뉜다.

Exception은 프로그램이 오류를 범한 경우, System call은 프로그램이 커널함수를 호출하는 경우를 의미한다.

그리고 인터럽트와 같이 알아두면 좋은 개념 2가지가 있다.

**1. 인터럽트벡터**

해당 인터럽트의 처리루틴 주소를 가지고 있는 것이다.

예를 들어, 키보드에서 인터럽트를 발생시켰다면 CPU에 3번 인터럽트가 발생했다고 왔을 것이다.

그러면 3번 인터럽트는 어떻게 해결해하는지에 대한 인터럽트처리루틴의 주소를 가리키는 정보를 담고 있는 것이 인터럽트벡터이다.

**2. 인터럽트처리루틴**

해당 인터럽트를 처리하는 커널함수이다.
