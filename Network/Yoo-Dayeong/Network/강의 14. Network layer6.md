# 강의 14. 네트워크 계층6

### count-to-infinity 해결하는 방법

→ **poisoned reverse**

count-to-infinity의 문제점은 어느 라우터를 거쳐서 가는 지에 대한 경로의 정보는 주어지지 않는 다는 것.

그러므로, 라우터를 거쳤다가 다시 돌아오는 `reversed path` 를 막아야 함!

따라서 distance 값을 넘겨줄 때, 이 distance 값에 결정적인 역할을 하는 인접 노드에 대해서만 무한대를 넘겨준다.

# Hierarchical Routing

네트워크의 스케일이 클 경우에는 계층화(hierarchical routing)한다.

link state, distance vector 알고리즘을 통해 라우터들을 연결시킴.

이때 바로 하나의 내부 네트워크에서만 이러한 알고리즘을 사용하고, 외부 네트워크를 연결하는데는 다른 알고리즘 사용함.

예시로, A기관의 네트워크 주체는 A기관이므로, 내부에서 사용될 알고리즘도 A기관이 정한다. 마찬가지로 B, C기관도 동일함. 이때 A, B, C를 아우르는 연결 알고리즘으로는 link state, distance vector 알고리즘은 쓰이지 않음.

그렇다면 어떤 알고리즘으로 연결할까?

→ **AS(Autonomous System)**

내부에서 사용하는 알고리즘 **intra-AS**, 외부에서 사용하는 알고리즘 **inter-AS**

## intra-AS/ inter-AS

- intra AS: RIP(distance vector), OSPF(link state)
  - 목적: **최단경로**
- inter AS: BGP
  - 목적: 최단경로 X / 정치-경제적인 요소들이 들어가서 BGP라는 프로토콜이 만들어 짐.

### AS사이 관계

As제공: Provider(갑)

As사용: Customer(을)

갑-을 관계가 형성되는 이유는, 인터넷을 제공하는 업체는 하드웨어, 인력, 데이터센터/전력 등등을 지불할 수 있는 많은 돈이 있다. 그렇기에 Provider-Customer 관계가 존재하게 된다. 이러한 상-하 관계 뿐만 아니라 peer 관계도 있다. 예시로 SKT-KT 사이에서 네트워크 트래픽을 무료로 오가게 하는 case가 있다.

# BGP(Border Gateway Protocol)

intra-AS가 최적거리에 따라 정해지는 것과 달리 **inter-AS**는 **정책**에 따라 좌우됨.

즉, 최적의 거리가 아니라 정치-경제적인 요소에 의해 결정됨.
![](./assets/ch14/bgp.jpeg)

- AS Path에 자기 자신을 계속 추가하며 이동하고 있음.
- 즉 이를 통해 목적지까지의 경로를 얻을 수 있다.
- 물론 그 경로의 수가 적은것이 좋겠지만, 수가 같다면 정책에 따라서 선택해주면 됨.
- 또한 비용도 고민해야 하므로 경제적인 부분을 선택
- 결국, **최소 비용&최대 이득**이 되는 경로 선택 → 최적의 경로는 신경 X

예를 들어 삼성전자는 현재 2개의 경우의 수 중에서 선택 가능.

`1129 > 1755 > 7018 > 6341`

`3549 > 15169 > 7018 > 6341`

*경로의 수*가 차이 없으므로, 여기서 정책적인 부분에서 갈리게 됨.

만약 구글을 통해 데이터가 오가는게 꺼림칙하다는 생각이 있다면.. 다른 경로를 선택할 수 있는 것처럼, 그 기업의 **정책**에 따라 결정되는 것이다.

**즉, intra-AS는 최적경로를 우선시하고, iner-AS는 최적경로가 아니라 정책을 중요시한다는 것.**
